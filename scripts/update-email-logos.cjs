#!/usr/bin/env node

/**
 * Script to convert logo images to base64 and update email-assets.ts
 * 
 * Usage:
 *   node scripts/update-email-logos.cjs
 * 
 * Make sure you have logo-black.png and logo-white.png in public/email-assets/
 */

const fs = require('fs');
const path = require('path');

const EMAIL_ASSETS_DIR = path.join(__dirname, '..', 'public', 'email-assets');
const OUTPUT_FILE = path.join(__dirname, '..', 'src', 'lib', 'email-assets.ts');

const LOGO_BLACK_PATH = path.join(EMAIL_ASSETS_DIR, 'logo-black.png');
const LOGO_WHITE_PATH = path.join(EMAIL_ASSETS_DIR, 'logo-white.png');

try {
  // Check if logo files exist
  if (!fs.existsSync(LOGO_BLACK_PATH)) {
    console.error(`‚ùå Error: ${LOGO_BLACK_PATH} not found!`);
    console.error('Please add logo-black.png to public/email-assets/');
    process.exit(1);
  }

  if (!fs.existsSync(LOGO_WHITE_PATH)) {
    console.error(`‚ùå Error: ${LOGO_WHITE_PATH} not found!`);
    console.error('Please add logo-white.png to public/email-assets/');
    process.exit(1);
  }

  // Read and convert logos to base64
  console.log('üì∏ Reading logo images...');
  const blackLogo = fs.readFileSync(LOGO_BLACK_PATH);
  const whiteLogo = fs.readFileSync(LOGO_WHITE_PATH);

  const blackBase64 = blackLogo.toString('base64');
  const whiteBase64 = whiteLogo.toString('base64');

  console.log('‚úÖ Converted logos to base64');
  console.log(`   Black logo: ${(blackBase64.length / 1024).toFixed(2)} KB`);
  console.log(`   White logo: ${(whiteBase64.length / 1024).toFixed(2)} KB`);

  // Generate the TypeScript file content
  const fileContent = `// Email assets - Base64 encoded logo images
// These images are embedded directly in emails for maximum compatibility
// This file is auto-generated by scripts/update-email-logos.cjs
// DO NOT EDIT MANUALLY - Run the script to update logos

export const EMAIL_LOGOS = {
  // Black logo for light mode
  logoBlack: \`data:image/png;base64,${blackBase64}\`,
  
  // White logo for dark mode
  logoWhite: \`data:image/png;base64,${whiteBase64}\`
};
`;

  // Write to file
  fs.writeFileSync(OUTPUT_FILE, fileContent, 'utf8');
  console.log(`‚úÖ Updated ${OUTPUT_FILE}`);
  console.log('‚ú® Email logos are now embedded in the code!');

} catch (error) {
  console.error('‚ùå Error:', error.message);
  process.exit(1);
}

